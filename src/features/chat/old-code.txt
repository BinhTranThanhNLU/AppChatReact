// addMessage(state, action: PayloadAction<Message>) {
    //   const { userId, content, time, to } = action.payload;
    //
    //   // 1. ThÃªm vÃ o danh sÃ¡ch tin nháº¯n chi tiáº¿t (nhÆ° cÅ©)
    //   state.messages.push(action.payload);
    //
    //   // 2. Cáº¬P NHáº¬T "PREVIEW" á» SIDEBAR (Logic má»›i thÃªm)
    //   // TÃ¬m user trong danh sÃ¡ch users Ä‘á»ƒ cáº­p nháº­t tin nháº¯n cuá»‘i cÃ¹ng
    //   const targetUserName = userId === "me" ? to : userId; // Logic xÃ¡c Ä‘á»‹nh user cáº§n update
    //
    //   const userIndex = state.users.findIndex(u => u.name === targetUserName || u.name === userId || u.name === to);
    //
    //   if (userIndex !== -1) {
    //     // Cáº­p nháº­t ná»™i dung vÃ  thá»i gian cho user Ä‘Ã³ trong sidebar
    //     state.users[userIndex].mes = content;
    //     state.users[userIndex].createAt = time;
    //
    //     // (TÃ¹y chá»n) ÄÆ°a user nÃ y lÃªn Ä‘áº§u danh sÃ¡ch
    //     const user = state.users.splice(userIndex, 1)[0];
    //     state.users.unshift(user);
    //   }
    // },
      addMessage(state, action: PayloadAction<Message>) {
          const { userId, content, time, to } = action.payload;

          // 1. ThÃªm vÃ o danh sÃ¡ch tin nháº¯n chi tiáº¿t (nhÆ° cÅ©)
          state.messages.push(action.payload);

          // 2. Cáº¬P NHáº¬T "PREVIEW" á» SIDEBAR
          // Logic sá»­a: Náº¿u userId lÃ  ngÆ°á»i gá»­i tin Ä‘áº¿n (khÃ¡c mÃ¬nh), update ngÆ°á»i Ä‘Ã³.
          // Náº¿u mÃ¬nh lÃ  ngÆ°á»i gá»­i (userId == to?), logic cáº§n check ká»¹ hÆ¡n.
          // CÃ¡ch Ä‘Æ¡n giáº£n nháº¥t: TÃ¬m user cÃ³ tÃªn trÃ¹ng vá»›i userId (ngÆ°á»i gá»­i) HOáº¶C to (ngÆ°á»i nháº­n)

          // TÃ¬m index cá»§a ngÆ°á»i cáº§n update trong danh sÃ¡ch users
          const userIndex = state.users.findIndex(u => u.name === userId || u.name === to);

          if (userIndex !== -1) {
              // Cáº­p nháº­t ná»™i dung vÃ  thá»i gian
              state.users[userIndex].mes = content;
              state.users[userIndex].createAt = time;

              // ÄÆ°a user nÃ y lÃªn Ä‘áº§u danh sÃ¡ch
              const user = state.users.splice(userIndex, 1)[0];
              state.users.unshift(user);
          }
      },

if (
      (res.event === "LOGIN" || res.event === "RE_LOGIN") &&
      res.status === "success"
    ) {
      const user = store.getState().auth.user!;
      store.dispatch(
        loginSuccess({ user, reLoginCode: res.data.RE_LOGIN_CODE })
      );
      localStorage.setItem(
        "auth",
        JSON.stringify({ user, code: res.data.RE_LOGIN_CODE })
      );

      // Láº¥y danh sÃ¡ch user ngay khi login xong
      sendSocket({ action: "onchat", data: { event: "GET_USER_LIST" } });
      return;
    }

if (res.event === "GET_USER_LIST") {
      console.log("ğŸ”¥ Dá»¯ liá»‡u User List tá»« Server:", res.data);
      store.dispatch(setUsers(res.data));
      return;
    }



    useEffect(() => {
        // Truyá»n callback vÃ o connectSocket
        connectSocket(() => {
            console.log("Socket Connected -> Sending RE_LOGIN...");
            const str = localStorage.getItem("auth");
            if (str) {
                const auth = JSON.parse(str);
                // Gá»­i thÃ´ng tin Ä‘Äƒng nháº­p láº¡i Ä‘á»ƒ Server biáº¿t socket nÃ y cá»§a ai
                sendSocket({
                    action: "onchat",
                    data: {
                        event: "RE_LOGIN",
                        data: {
                            user: auth.user,
                            code: auth.code, // Äáº£m báº£o server cáº§n code nÃ y Ä‘á»ƒ xÃ¡c thá»±c
                        },
                    },
                });
            }
        });
    }, []);