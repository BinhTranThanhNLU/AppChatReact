// addMessage(state, action: PayloadAction<Message>) {
    //   const { userId, content, time, to } = action.payload;
    //
    //   // 1. Thêm vào danh sách tin nhắn chi tiết (như cũ)
    //   state.messages.push(action.payload);
    //
    //   // 2. CẬP NHẬT "PREVIEW" Ở SIDEBAR (Logic mới thêm)
    //   // Tìm user trong danh sách users để cập nhật tin nhắn cuối cùng
    //   const targetUserName = userId === "me" ? to : userId; // Logic xác định user cần update
    //
    //   const userIndex = state.users.findIndex(u => u.name === targetUserName || u.name === userId || u.name === to);
    //
    //   if (userIndex !== -1) {
    //     // Cập nhật nội dung và thời gian cho user đó trong sidebar
    //     state.users[userIndex].mes = content;
    //     state.users[userIndex].createAt = time;
    //
    //     // (Tùy chọn) Đưa user này lên đầu danh sách
    //     const user = state.users.splice(userIndex, 1)[0];
    //     state.users.unshift(user);
    //   }
    // },
      addMessage(state, action: PayloadAction<Message>) {
          const { userId, content, time, to } = action.payload;

          // 1. Thêm vào danh sách tin nhắn chi tiết (như cũ)
          state.messages.push(action.payload);

          // 2. CẬP NHẬT "PREVIEW" Ở SIDEBAR
          // Logic sửa: Nếu userId là người gửi tin đến (khác mình), update người đó.
          // Nếu mình là người gửi (userId == to?), logic cần check kỹ hơn.
          // Cách đơn giản nhất: Tìm user có tên trùng với userId (người gửi) HOẶC to (người nhận)

          // Tìm index của người cần update trong danh sách users
          const userIndex = state.users.findIndex(u => u.name === userId || u.name === to);

          if (userIndex !== -1) {
              // Cập nhật nội dung và thời gian
              state.users[userIndex].mes = content;
              state.users[userIndex].createAt = time;

              // Đưa user này lên đầu danh sách
              const user = state.users.splice(userIndex, 1)[0];
              state.users.unshift(user);
          }
      },